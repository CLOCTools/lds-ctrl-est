<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.80.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Controller.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="ldsCtrlEst_h/lds_ctrl.h" />
<meta property="og:description" content="Controller." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stanley-rozell.github.io/lds-ctrl-est/docs/api/files/lds__ctrl_8h/" />

<title>ldsCtrlEst_h/lds_ctrl.h | LDS C&amp;E</title>
<link rel="manifest" href="/lds-ctrl-est/manifest.json">
<link rel="icon" href="/lds-ctrl-est/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/lds-ctrl-est/book.min.44110be292c9f873dbe57bd8895d52b387519bad9a89a86ed5c3705e11d6b0d5.css" integrity="sha256-RBEL4pLJ&#43;HPb5XvYiV1Ss4dRm62aiahu1cNwXhHWsNU=">
<script defer src="/lds-ctrl-est/en.search.min.59e9fb50a9e3a22d5e8217a3e68fd61abf93ed2a6aa67173fe82b9e3724f1683.js" integrity="sha256-Wen7UKnjoi1eghej5o/WGr&#43;T7SpqpnFz/oK543JPFoM="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/lds-ctrl-est"><img src="/lds-ctrl-est/ldsctrlest-logo.png" alt="Logo" /><span>LDS C&amp;E</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li><strong>Library Terminology</strong>
<ul>
<li><a href="/lds-ctrl-est/docs/terminology/model/"><strong>Model Definitions</strong></a></li>
<li><a href="/lds-ctrl-est/docs/terminology/control-estimation/"><strong>Control &amp; Estimation</strong></a></li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li><a href="/lds-ctrl-est/docs/getting-started/"><strong>Getting Started</strong></a></li>
</ul>
<p><br /></p>
<ul>
<li><strong>Tutorials</strong>
<ul>
<li><a href="/lds-ctrl-est/docs/tutorials/eg_glds_control/">GLDS Control</a></li>
<li><a href="/lds-ctrl-est/docs/tutorials/eg_plds_state_estimation/">PLDS Estimation</a></li>
<li><a href="/lds-ctrl-est/docs/tutorials/eg_switched_plds_control/">Switched PLDS Control</a></li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li><strong>API Reference</strong>
<ul>
<li><a href="/lds-ctrl-est/docs/api/namespaces/">Namespaces</a></li>
<li><a href="/lds-ctrl-est/docs/api/classes/">Classes</a></li>
<li><a href="/lds-ctrl-est/docs/api/modules/">Modules</a></li>
<li><a href="/lds-ctrl-est/docs/api/files/">Files</a></li>
<li><a href="/lds-ctrl-est/docs/api/examples/">Examples</a></li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li><a href="/lds-ctrl-est/issues-contributing/"><strong>Reporting Issues &amp; Contributing</strong></a></li>
</ul>
<p><br /></p>
<ul>
<li><a href="/lds-ctrl-est/acknowledgements/"><strong>Acknowledgements</strong></a></li>
</ul>
<p><br /></p>






  
<ul>
  
  <li>
    <a href="https://github.com/stanley-rozell/lds-ctrl-est" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/lds-ctrl-est/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>ldsCtrlEst_h/lds_ctrl.h</strong>

  <label for="toc-control">
    
    <img src="/lds-ctrl-est/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#ldsctrlest_hlds_ctrlh">ldsCtrlEst_h/lds_ctrl.h</a>
      <ul>
        <li><a href="#namespaces">Namespaces</a></li>
        <li><a href="#classes">Classes</a></li>
        <li><a href="#detailed-description">Detailed Description</a></li>
        <li><a href="#source-code">Source code</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="ldsctrlest_hlds_ctrlh">
  ldsCtrlEst_h/lds_ctrl.h
  <a class="anchor" href="#ldsctrlest_hlds_ctrlh">#</a>
</h1>
<p>Controller.  <a href="#detailed-description">More&hellip;</a></p>
<h2 id="namespaces">
  Namespaces
  <a class="anchor" href="#namespaces">#</a>
</h2>
<table>
<thead>
<tr>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="/lds-ctrl-est/docs/api/namespaces/namespacelds/">lds</a></strong> <br>Linear Dynamical Systems (LDS) namespace.</td>
</tr>
</tbody>
</table>
<h2 id="classes">
  Classes
  <a class="anchor" href="#classes">#</a>
</h2>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>class</td>
<td><strong><a href="/lds-ctrl-est/docs/api/classes/classlds_1_1_controller/">lds::Controller</a></strong></td>
</tr>
</tbody>
</table>
<h2 id="detailed-description">
  Detailed Description
  <a class="anchor" href="#detailed-description">#</a>
</h2>
<p>This file declares the type for control of a linear dynamical system (<a href="/lds-ctrl-est/docs/api/classes/classlds_1_1_controller/">lds::Controller</a>).</p>
<h2 id="source-code">
  Source code
  <a class="anchor" href="#source-code">#</a>
</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">//===-- ldsCtrlEst_h/lds_control.h - Controller -----------------*- C++ -*-===//
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// Copyright 2021 Georgia Institute of Technology
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span><span style="color:#75715e">// you may not use this file except in compliance with the License.
</span><span style="color:#75715e">// You may obtain a copy of the License at
</span><span style="color:#75715e">//
</span><span style="color:#75715e">//     http://www.apache.org/licenses/LICENSE-2.0
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// Unless required by applicable law or agreed to in writing, software
</span><span style="color:#75715e">// distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span><span style="color:#75715e">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span style="color:#75715e">// See the License for the specific language governing permissions and
</span><span style="color:#75715e">// limitations under the License.
</span><span style="color:#75715e">//
</span><span style="color:#75715e">//===----------------------------------------------------------------------===//
</span><span style="color:#75715e">//===----------------------------------------------------------------------===//
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#ifndef LDSCTRLEST_LDS_CTRL_H
</span><span style="color:#75715e">#define LDSCTRLEST_LDS_CTRL_H
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// namespace
</span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;lds.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">// system type
</span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;lds_sys.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">namespace</span> lds {

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Controller</span> {
  <span style="color:#66d9ef">static_assert</span>(std<span style="color:#f92672">::</span>is_base_of<span style="color:#f92672">&lt;</span>lds<span style="color:#f92672">::</span>System, System<span style="color:#f92672">&gt;::</span>value,
                <span style="color:#e6db74">&#34;System must be derived from lds::System type.&#34;</span>);

 <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  Controller() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;

  Controller(<span style="color:#66d9ef">const</span> System<span style="color:#f92672">&amp;</span> sys, data_t u_lb, data_t u_ub,
             size_t control_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>);

  Controller(System<span style="color:#f92672">&amp;&amp;</span> sys, data_t u_lb, data_t u_ub, size_t control_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>);

  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> Control(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> z, <span style="color:#66d9ef">bool</span> do_control <span style="color:#f92672">=</span> true,
                        <span style="color:#66d9ef">bool</span> do_lock_control <span style="color:#f92672">=</span> false,
                        data_t sigma_soft_start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, data_t sigma_u_noise <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
                        <span style="color:#66d9ef">bool</span> do_reset_at_control_onset <span style="color:#f92672">=</span> true);

  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> ControlOutputReference(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> z, <span style="color:#66d9ef">bool</span> do_control <span style="color:#f92672">=</span> true,
                                       <span style="color:#66d9ef">bool</span> do_estimation <span style="color:#f92672">=</span> true,
                                       <span style="color:#66d9ef">bool</span> do_lock_control <span style="color:#f92672">=</span> false,
                                       data_t sigma_soft_start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
                                       data_t sigma_u_noise <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
                                       <span style="color:#66d9ef">bool</span> do_reset_at_control_onset <span style="color:#f92672">=</span> true);

  <span style="color:#75715e">// get methods:
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> System<span style="color:#f92672">&amp;</span> sys() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> sys_; };
  <span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> Kc_; };
  <span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc_inty() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> Kc_inty_; };
  <span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc_u() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> Kc_u_; };
  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> g_design() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> g_design_; };
  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> u_ref() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> u_ref_; };
  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> x_ref() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> x_ref_; };
  <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> y_ref() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> y_ref_; };
  size_t <span style="color:#a6e22e">control_type</span>() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> control_type_; };

  <span style="color:#75715e">// set methods
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_sys</span>(<span style="color:#66d9ef">const</span> System<span style="color:#f92672">&amp;</span> sys) {
    <span style="color:#66d9ef">bool</span> does_match <span style="color:#f92672">=</span> sys_.n_u() <span style="color:#f92672">==</span> sys.n_u();
    does_match <span style="color:#f92672">=</span> does_match <span style="color:#f92672">&amp;&amp;</span> (sys_.n_x() <span style="color:#f92672">==</span> sys.n_x());
    does_match <span style="color:#f92672">=</span> does_match <span style="color:#f92672">&amp;&amp;</span> (sys_.n_y() <span style="color:#f92672">==</span> sys.n_y());
    <span style="color:#66d9ef">if</span> (does_match) {
      sys_ <span style="color:#f92672">=</span> sys;
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">throw</span> std<span style="color:#f92672">::</span>runtime_error(
          <span style="color:#e6db74">&#34;new system argument to `set_sys` does not match dimensionality of &#34;</span>
          <span style="color:#e6db74">&#34;existing system&#34;</span>);
    }
  };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_g_design</span>(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> g_design) { Reassign(g_design_, g_design); };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_u_ref</span>(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> u_ref) { Reassign(u_ref_, u_ref); };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_x_ref</span>(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> x_ref) {
    Reassign(x_ref_, x_ref);
    cx_ref_ <span style="color:#f92672">=</span> sys_.C() <span style="color:#f92672">*</span> x_ref_;
  };

  <span style="color:#75715e">// y_ref needs to be handled differently depending on output fn.
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// (need to populate cx_ref_ too, which depends on output fn)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_y_ref</span>(<span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> y_ref) { Reassign(y_ref_, y_ref); };

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_Kc</span>(<span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc) { Reassign(Kc_, Kc); };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_Kc_inty</span>(<span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc_inty) { Reassign(Kc_inty_, Kc_inty); };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_Kc_u</span>(<span style="color:#66d9ef">const</span> Matrix<span style="color:#f92672">&amp;</span> Kc_u) { Reassign(Kc_u_, Kc_u); };
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_tau_awu</span>(data_t tau) {
    tau_awu_ <span style="color:#f92672">=</span> tau;
    k_awu_ <span style="color:#f92672">=</span> sys_.dt() <span style="color:#f92672">/</span> tau_awu_;
  };

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_control_type</span>(size_t control_type);

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Reset</span>() {
    sys_.Reset();
    u_ref_.zeros();
    u_ref_prev_.zeros();
    int_e_.zeros();
    int_e_awu_adjust_.zeros();
    u_sat_.zeros();
    u_saturated_ <span style="color:#f92672">=</span> false;
    t_since_control_onset_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
  };

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Print</span>() {
    sys_.Print();
    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;g_design : &#34;</span> <span style="color:#f92672">&lt;&lt;</span> g_design_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;u_lb : &#34;</span> <span style="color:#f92672">&lt;&lt;</span> u_lb_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;u_ub : &#34;</span> <span style="color:#f92672">&lt;&lt;</span> u_ub_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
  };

 <span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
  System sys_;  

  Vector u_;  

  Vector g_design_;  

  <span style="color:#75715e">//  reference signals
</span><span style="color:#75715e"></span>  Vector u_ref_;  
  <span style="color:#75715e">// create no set method for this:
</span><span style="color:#75715e"></span>  Vector u_ref_prev_;  
  Vector x_ref_;       
  Vector y_ref_;       
  Vector cx_ref_;

  <span style="color:#75715e">// Controller gains
</span><span style="color:#75715e"></span>  Matrix Kc_;  
  Matrix
      Kc_u_;  
  Matrix Kc_inty_;  

  <span style="color:#75715e">// control after g inversion
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// do not need set methods for these.
</span><span style="color:#75715e"></span>  Vector du_ref_;
  Vector dv_ref_;
  Vector v_ref_;
  Vector dv_;
  Vector v_;  

  <span style="color:#75715e">// integral error
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// do not need set method for this
</span><span style="color:#75715e"></span>  Vector int_e_;             
  Vector int_e_awu_adjust_;  
  Vector u_sat_;  

  <span style="color:#66d9ef">bool</span> do_control_prev_ <span style="color:#f92672">=</span> false;
  <span style="color:#66d9ef">bool</span> do_lock_control_prev_ <span style="color:#f92672">=</span> false;

  <span style="color:#75715e">// whether the g of system has become inverted from what you think it is
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// (gain_ref)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">bool</span> u_saturated_ <span style="color:#f92672">=</span>
      false;  

  <span style="color:#75715e">// should be safe to have references here bc nothing needs to be done
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// (like reset vars) when it changes...
</span><span style="color:#75715e"></span>  data_t u_lb_{};  
  data_t u_ub_{};  

  data_t tau_awu_{};  
  data_t k_awu_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

  data_t t_since_control_onset_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  
  size_t control_type_{};             

 <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
  <span style="color:#66d9ef">void</span> CalcControl(<span style="color:#66d9ef">bool</span> do_control <span style="color:#f92672">=</span> true, <span style="color:#66d9ef">bool</span> do_estimation <span style="color:#f92672">=</span> true,
                   <span style="color:#66d9ef">bool</span> do_lock_control <span style="color:#f92672">=</span> false, data_t sigma_soft_start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
                   data_t sigma_u_noise <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
                   <span style="color:#66d9ef">bool</span> do_reset_at_control_onset <span style="color:#f92672">=</span> true);

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalcSteadyStateSetPoint</span>();

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">AntiWindup</span>();

  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">InitVars</span>();
};

<span style="color:#75715e">// Implement the above:
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>Controller(<span style="color:#66d9ef">const</span> System<span style="color:#f92672">&amp;</span> sys, data_t u_lb,
                                      data_t u_ub, size_t control_type)
    <span style="color:#f92672">:</span> sys_(sys),
      u_lb_(u_lb),
      u_ub_(u_ub),
      control_type_(control_type),
      tau_awu_(lds<span style="color:#f92672">::</span>kInf)
{
  InitVars();
}

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>Controller(System<span style="color:#f92672">&amp;&amp;</span> sys, data_t u_lb, data_t u_ub,
                                      size_t control_type)
    <span style="color:#f92672">:</span> sys_(std<span style="color:#f92672">::</span>move(sys)),
      u_lb_(u_lb),
      u_ub_(u_ub),
      control_type_(control_type),
      tau_awu_(lds<span style="color:#f92672">::</span>kInf) {
  InitVars();
}

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>set_control_type(size_t control_type) {
  <span style="color:#66d9ef">if</span> (control_type_ <span style="color:#f92672">==</span> control_type) {
    <span style="color:#66d9ef">return</span>;
  }

  <span style="color:#75715e">// creating a blank slate...
</span><span style="color:#75715e"></span>  control_type_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  Kc_inty_.zeros(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
  Kc_u_.zeros(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
  int_e_.zeros(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
  int_e_awu_adjust_.zeros(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);

  <span style="color:#75715e">// controller was designed to minimize integral error
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (control_type <span style="color:#f92672">&amp;</span> kControlTypeIntY) {
    Kc_inty_.zeros(sys_.n_u(), sys_.n_y());
    int_e_.zeros(sys_.n_y());
    int_e_awu_adjust_.zeros(sys_.n_u());
    control_type_ <span style="color:#f92672">=</span> control_type_ <span style="color:#f92672">|</span> kControlTypeIntY;
  }

  <span style="color:#75715e">// controller was designed to minimize deltaU
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// (i.e. state augmented with u)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (control_type <span style="color:#f92672">&amp;</span> kControlTypeDeltaU) {
    Kc_u_.zeros(sys_.n_u(), sys_.n_u());
    control_type_ <span style="color:#f92672">=</span> control_type_ <span style="color:#f92672">|</span> kControlTypeDeltaU;
  }

  <span style="color:#75715e">// whether to adapt set point calculate with (re-estimated) process
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// disturbance (m)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (control_type <span style="color:#f92672">&amp;</span> kControlTypeAdaptM) {
    <span style="color:#66d9ef">if</span> (sys_.do_adapt_m)  <span style="color:#75715e">// only if adapting m...
</span><span style="color:#75715e"></span>    {
      control_type_ <span style="color:#f92672">=</span> control_type_ <span style="color:#f92672">|</span> kControlTypeAdaptM;
    }
  }
}  <span style="color:#75715e">// set_control_type
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>Control(
    <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> z, <span style="color:#66d9ef">bool</span> do_control, <span style="color:#66d9ef">bool</span> do_lock_control,
    data_t sigma_soft_start, data_t sigma_u_noise,
    <span style="color:#66d9ef">bool</span> do_reset_at_control_onset) {
  <span style="color:#75715e">// update state estimates, given latest measurement
</span><span style="color:#75715e"></span>  sys_.Filter(u_, z);

  <span style="color:#66d9ef">bool</span> do_estimation <span style="color:#f92672">=</span> true;  <span style="color:#75715e">// always have estimator on in this case
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// calculate control signal
</span><span style="color:#75715e"></span>  CalcControl(do_control, do_estimation, do_lock_control, sigma_soft_start,
              sigma_u_noise, do_reset_at_control_onset);

  <span style="color:#66d9ef">return</span> u_;
}

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>ControlOutputReference(
    <span style="color:#66d9ef">const</span> Vector<span style="color:#f92672">&amp;</span> z, <span style="color:#66d9ef">bool</span> do_control, <span style="color:#66d9ef">bool</span> do_estimation, <span style="color:#66d9ef">bool</span> do_lock_control,
    data_t sigma_soft_start, data_t sigma_u_noise,
    <span style="color:#66d9ef">bool</span> do_reset_at_control_onset) {
  <span style="color:#75715e">// update state estimates, given latest measurement
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (do_estimation) {
    sys_.Filter(u_, z);
  } <span style="color:#66d9ef">else</span> {
    sys_.f(u_);
  }

  <span style="color:#75715e">// calculate the set point
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// solves for u_ref and x_ref when output is at y_ref at steady state.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (do_control) {
    CalcSteadyStateSetPoint();
  }

  <span style="color:#75715e">// calculate control signal
</span><span style="color:#75715e"></span>  CalcControl(do_control, do_estimation, do_lock_control, sigma_soft_start,
              sigma_u_noise, do_reset_at_control_onset);

  <span style="color:#66d9ef">return</span> u_;
}

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>CalcControl(<span style="color:#66d9ef">bool</span> do_control, <span style="color:#66d9ef">bool</span> do_estimation,
                                            <span style="color:#66d9ef">bool</span> do_lock_control,
                                            data_t sigma_soft_start,
                                            data_t sigma_u_noise,
                                            <span style="color:#66d9ef">bool</span> do_reset_at_control_onset) {
  <span style="color:#66d9ef">if</span> (do_control <span style="color:#f92672">&amp;&amp;</span> do_estimation) {
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>do_control_prev_) {
      <span style="color:#66d9ef">if</span> (do_reset_at_control_onset) {
        Reset();
      }
      t_since_control_onset_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
    } <span style="color:#66d9ef">else</span> {
      t_since_control_onset_ <span style="color:#f92672">+=</span> sys_.dt();
    }

    <span style="color:#75715e">// enforce softstart on control vars.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (sigma_soft_start <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#75715e">// half-Gaussian soft-start scaling factor
</span><span style="color:#75715e"></span>      data_t soft_start_sf <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> exp(<span style="color:#f92672">-</span>pow(t_since_control_onset_, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span>
                                     (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pow(sigma_soft_start, <span style="color:#ae81ff">2</span>)));
      u_ref_ <span style="color:#f92672">*=</span> soft_start_sf;
      <span style="color:#75715e">// TODO(mfbolus): May be appropriate to soft-start x_ref, y_ref too
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// x_ref_ *= soft_start_sf;
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// cx_ref_ *= soft_start_sf;
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// y_ref_ *= soft_start_sf;
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>do_lock_control) {
      du_ref_ <span style="color:#f92672">=</span> u_ref_ <span style="color:#f92672">-</span> u_ref_prev_;

      <span style="color:#75715e">// first do u -&gt; v change of vars. (v = g.*u)
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// e.g., convert into physical units (e.g., v[=] mW/mm2 rather than driver
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// control voltage u[=]V)
</span><span style="color:#75715e"></span>      v_ref_ <span style="color:#f92672">=</span> g_design_ <span style="color:#f92672">%</span> u_ref_;
      dv_ref_ <span style="color:#f92672">=</span> g_design_ <span style="color:#f92672">%</span> du_ref_;

      <span style="color:#75715e">// Given FB, calc. the change in control
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (control_type_ <span style="color:#f92672">&amp;</span> kControlTypeDeltaU) {
        <span style="color:#75715e">// if control designed to minimize not u but deltaU (i.e. state aug with
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// u):
</span><span style="color:#75715e"></span>        dv_ <span style="color:#f92672">=</span> dv_ref_;                     <span style="color:#75715e">// nominally-optimal.
</span><span style="color:#75715e"></span>        dv_ <span style="color:#f92672">-=</span> Kc_ <span style="color:#f92672">*</span> (sys_.x() <span style="color:#f92672">-</span> x_ref_);  <span style="color:#75715e">// instantaneous state error
</span><span style="color:#75715e"></span>        dv_ <span style="color:#f92672">-=</span> Kc_u_ <span style="color:#f92672">*</span> (v_ <span style="color:#f92672">-</span> v_ref_);      <span style="color:#75715e">// penalty on amp u (rel to ref)
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">if</span> (control_type_ <span style="color:#f92672">&amp;</span> kControlTypeIntY) {
          <span style="color:#75715e">// TODO(mfbolus): one approach to protection against integral windup
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// would be to not integrate error when control signal saturated:
</span><span style="color:#75715e"></span>
          <span style="color:#75715e">// if(!uSaturated)
</span><span style="color:#75715e"></span>          int_e_ <span style="color:#f92672">+=</span> (sys_.cx() <span style="color:#f92672">-</span> cx_ref_) <span style="color:#f92672">*</span> sys_.dt();  <span style="color:#75715e">// integrated error
</span><span style="color:#75715e"></span>          dv_ <span style="color:#f92672">-=</span> Kc_inty_ <span style="color:#f92672">*</span> int_e_;  <span style="color:#75715e">// control for integrated error
</span><span style="color:#75715e"></span>        }

        <span style="color:#75715e">// update the control
</span><span style="color:#75715e"></span>        v_ <span style="color:#f92672">+=</span> dv_;
      } <span style="color:#66d9ef">else</span> {
        v_ <span style="color:#f92672">=</span> v_ref_;                      <span style="color:#75715e">// nominally-optimal.
</span><span style="color:#75715e"></span>        v_ <span style="color:#f92672">-=</span> Kc_ <span style="color:#f92672">*</span> (sys_.x() <span style="color:#f92672">-</span> x_ref_);  <span style="color:#75715e">// instantaneous state error
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">if</span> (control_type_ <span style="color:#f92672">&amp;</span> kControlTypeIntY) {
          <span style="color:#75715e">// TODO(mfbolus): one approach to protection against integral windup
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// would be to not integrate error when control signal saturated:
</span><span style="color:#75715e"></span>
          <span style="color:#75715e">// if (!uSaturated)
</span><span style="color:#75715e"></span>          int_e_ <span style="color:#f92672">+=</span> (sys_.cx() <span style="color:#f92672">-</span> cx_ref_) <span style="color:#f92672">*</span> sys_.dt();  <span style="color:#75715e">// integrated error
</span><span style="color:#75715e"></span>          v_ <span style="color:#f92672">-=</span> Kc_inty_ <span style="color:#f92672">*</span> int_e_;  <span style="color:#75715e">// control for integrated error
</span><span style="color:#75715e"></span>        }
      }

      <span style="color:#75715e">// convert back to control voltage u[=]V
</span><span style="color:#75715e"></span>      u_ <span style="color:#f92672">=</span> v_ <span style="color:#f92672">/</span> sys_.g();
    }  <span style="color:#75715e">// else do nothing until lock is low
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// It may be desireable to make inputs more variable.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (sigma_u_noise <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span>) {
      u_ <span style="color:#f92672">+=</span> sigma_u_noise <span style="color:#f92672">*</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>randn);
    };

  } <span style="color:#66d9ef">else</span> {  <span style="color:#75715e">// if not control
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// feed through u_ref in open loop
</span><span style="color:#75715e"></span>    u_ <span style="color:#f92672">=</span> u_ref_ <span style="color:#f92672">%</span> g_design_ <span style="color:#f92672">/</span> sys_.g();
    u_ref_.zeros();
    int_e_.zeros();
    int_e_awu_adjust_.zeros();
    u_sat_.zeros();
  }  <span style="color:#75715e">// ends do_control
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// enforce box constraints (and antiwindup)
</span><span style="color:#75715e"></span>  AntiWindup();

  do_control_prev_ <span style="color:#f92672">=</span> do_control;
  do_lock_control_prev_ <span style="color:#f92672">=</span> do_lock_control;
}  <span style="color:#75715e">// CalcControl
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>CalcSteadyStateSetPoint() {
  <span style="color:#75715e">// Linearly-constrained least squares (ls).
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// _reference:
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//  Boyd &amp; Vandenberghe (2018) Introduction to Applied Linear Algebra
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//
</span><span style="color:#75715e"></span>  Matrix a_ls <span style="color:#f92672">=</span>
      join_horiz(sys_.C(), Matrix(sys_.n_y(), sys_.n_u(), fill<span style="color:#f92672">::</span>zeros));
  Vector b_ls <span style="color:#f92672">=</span> cx_ref_;
  Matrix c_ls <span style="color:#f92672">=</span> join_horiz(sys_.A() <span style="color:#f92672">-</span> Matrix(sys_.n_x(), sys_.n_x(), fill<span style="color:#f92672">::</span>eye),
                           sys_.B() <span style="color:#f92672">*</span> arma<span style="color:#f92672">::</span>diagmat(sys_.g()));
  Vector d_ls <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>sys_.m0();
  <span style="color:#66d9ef">if</span> (control_type_ <span style="color:#f92672">&amp;</span> kControlTypeAdaptM) {
    d_ls <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>sys_.m();  <span style="color:#75715e">// adapt setpoint calc with disturbance?
</span><span style="color:#75715e"></span>  }

  Matrix a_ls_t <span style="color:#f92672">=</span> a_ls.t();  <span style="color:#75715e">// TODO(mfbolus): not sure why but causes seg
</span><span style="color:#75715e"></span>                             <span style="color:#75715e">// fault if I do not do this.
</span><span style="color:#75715e"></span>  Matrix phi_ls <span style="color:#f92672">=</span>
      join_vert(join_horiz(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> a_ls_t <span style="color:#f92672">*</span> a_ls, c_ls.t()),
                join_horiz(c_ls, Matrix(sys_.n_x(), sys_.n_x(), fill<span style="color:#f92672">::</span>zeros)));
  <span style="color:#75715e">// TODO(mfbolus): should be actual inverse, rather than pseudo-inverse:
</span><span style="color:#75715e"></span>  Matrix inv_phi <span style="color:#f92672">=</span> pinv(phi_ls);
  Vector xulam <span style="color:#f92672">=</span> inv_phi <span style="color:#f92672">*</span> join_vert(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> a_ls_t <span style="color:#f92672">*</span> b_ls, d_ls);
  x_ref_ <span style="color:#f92672">=</span> xulam.subvec(<span style="color:#ae81ff">0</span>, sys_.n_x() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
  u_ref_ <span style="color:#f92672">=</span> xulam.subvec(sys_.n_x(), sys_.n_x() <span style="color:#f92672">+</span> sys_.n_u() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
  cx_ref_ <span style="color:#f92672">=</span> sys_.C() <span style="color:#f92672">*</span> x_ref_;
}  <span style="color:#75715e">// CalcSteadyStateSetPoint
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">void</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>AntiWindup() {
  u_saturated_ <span style="color:#f92672">=</span> false;
  u_sat_ <span style="color:#f92672">=</span> u_;

  <span style="color:#75715e">// limit u and flag whether saturated
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> (size_t k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> u_.n_elem; k<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">if</span> (u_[k] <span style="color:#f92672">&lt;</span> u_lb_) {
      u_sat_[k] <span style="color:#f92672">=</span> u_lb_;
      u_saturated_ <span style="color:#f92672">=</span> true;
    }

    <span style="color:#66d9ef">if</span> (u_[k] <span style="color:#f92672">&gt;</span> u_ub_) {
      u_sat_[k] <span style="color:#f92672">=</span> u_ub_;
      u_saturated_ <span style="color:#f92672">=</span> true;
    }
  }

  <span style="color:#66d9ef">if</span> ((control_type_ <span style="color:#f92672">&amp;</span> kControlTypeIntY) <span style="color:#f92672">&amp;&amp;</span> (tau_awu_ <span style="color:#f92672">&lt;</span> lds<span style="color:#f92672">::</span>kInf)) {
    <span style="color:#75715e">// one-step back-calculation (calculate intE for u=u_sat)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// (Astroem, Rundqwist 1989 warn against using this...)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// int_e_awu_adjust_ =
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//     solve(Kc_inty_, (u_ - u_sat_));  // pinv(Kc_inty) * (u-uSat);
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// gradual: see Astroem, Rundqwist 1989
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// this is a fudge for doing MIMO gradual
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// n.b., went ahead and multiplied 1/T by dt so don&#39;t have to do that here.
</span><span style="color:#75715e"></span>    int_e_awu_adjust_ <span style="color:#f92672">=</span>
        k_awu_ <span style="color:#f92672">*</span> (sign(Kc_inty_).t() <span style="color:#f92672">/</span> sys_.n_u()) <span style="color:#f92672">*</span> (u_ <span style="color:#f92672">-</span> u_sat_);
    <span style="color:#75715e">// int_e_awu_adjust_ = k_awu_ * (u_-u_sat_);
</span><span style="color:#75715e"></span>
    int_e_ <span style="color:#f92672">+=</span> int_e_awu_adjust_;
  }

  <span style="color:#75715e">// set u to saturated version
</span><span style="color:#75715e"></span>  u_ <span style="color:#f92672">=</span> u_sat_;
}

<span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> System<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">void</span> Controller<span style="color:#f92672">&lt;</span>System<span style="color:#f92672">&gt;::</span>InitVars() {
  <span style="color:#75715e">// initialize to default values
</span><span style="color:#75715e"></span>  u_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  u_ref_prev_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  x_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_x(), fill<span style="color:#f92672">::</span>zeros);
  y_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_y(), fill<span style="color:#f92672">::</span>zeros);

  u_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  u_sat_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);

  <span style="color:#75715e">// Might not need all these, so zero elements until later.
</span><span style="color:#75715e"></span>  Kc_ <span style="color:#f92672">=</span> Matrix(sys_.n_u(), sys_.n_x(), fill<span style="color:#f92672">::</span>zeros);
  Kc_u_ <span style="color:#f92672">=</span> Matrix(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, fill<span style="color:#f92672">::</span>zeros);
  Kc_inty_ <span style="color:#f92672">=</span> Matrix(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, fill<span style="color:#f92672">::</span>zeros);

  g_design_ <span style="color:#f92672">=</span> sys_.g();  <span style="color:#75715e">// by default, same as model
</span><span style="color:#75715e"></span>  dv_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  v_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  du_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  dv_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);
  v_ref_ <span style="color:#f92672">=</span> Vector(sys_.n_u(), fill<span style="color:#f92672">::</span>zeros);

  int_e_ <span style="color:#f92672">=</span> Vector(<span style="color:#ae81ff">0</span>, fill<span style="color:#f92672">::</span>zeros);
  int_e_awu_adjust_ <span style="color:#f92672">=</span> Vector(<span style="color:#ae81ff">0</span>, fill<span style="color:#f92672">::</span>zeros);

  set_control_type(control_type_);
}

}  <span style="color:#75715e">// namespace lds
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif
</span></code></pre></div><hr>
<p>Updated on 24 March 2021 at 13:26:05 EDT</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#ldsctrlest_hlds_ctrlh">ldsCtrlEst_h/lds_ctrl.h</a>
      <ul>
        <li><a href="#namespaces">Namespaces</a></li>
        <li><a href="#classes">Classes</a></li>
        <li><a href="#detailed-description">Detailed Description</a></li>
        <li><a href="#source-code">Source code</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












